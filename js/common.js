$(function(){var startX=0;var startY=0;var $menuList=$("header .menu-list,header nav");var $searchText=$("#searchText");var $search=$("#search");var $phoneSearchText=$("#phoneSearchText");$("header .menu-btn").on("click",function(e){e.stopPropagation();$menuList.slideToggle("fast")});$(window).on("resize",function(){$menuList.hide()}).on("click",function(){$menuList.hide()}).on("touchstart",function(e){startX=e.originalEvent.changedTouches[0].pageX;startY=e.originalEvent.changedTouches[0].pageY}).on("touchmove",function(e){var endX=e.originalEvent.changedTouches[0].pageX;var endY=e.originalEvent.changedTouches[0].pageY;var direction=getSlideDirection(startX,startY,endX,endY);if(direction===1){$menuList.hide()}});$menuList.on("click",function(e){e.stopPropagation()}).on("touchmove",function(e){e.stopPropagation()});$search.on("click",function(){search($searchText.val().trim())});$searchText.on("keyup",function(event){if(event.keyCode===13){search($searchText.val().trim())}});$phoneSearchText.on("keyup",function(event){if(event.keyCode===13){search($(this).val().trim())}});function search(text){(text&&text.trim().length!==0)&&(location.href="/search/"+text)}function getSlideDirection(startX,startY,endX,endY){var dy=startY-endY;var result=0;if(dy>0){result=1}else{if(dy<0){result=2}else{result=0}}return result}function lazyLoadImg($img){var img=new Image();var retryCount=parseInt($img.data("retry-count"))||0;img.onload=function(res){$img.replaceWith(img)};img.onerror=function(){if(retryCount<3){lazyLoadImg($img)}else{console.log("图片加载失败:"+$img.data("src"))}};$img.data("retry-count",retryCount+1);img.src=$img.data("src")}var $itemPwd=$(".content .data .lock input");$(".content .data ").find("img").each(function(){lazyLoadImg($(this))}).end().find(".lock .error").fadeOut(5000).end().find(".lock button").on("click",function(){$(this).prop("disabled",true);gotoItemWithPwd()});$itemPwd.on("keyup",function(event){if(event.keyCode===13){gotoItemWithPwd()}});function gotoItemWithPwd(){location.href=location.protocol+"//"+location.host+location.pathname+"?pw="+$itemPwd.val()}});
